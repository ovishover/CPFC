<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        #suggestions {
            display: none;
            position: absolute;
            border: 1px solid #ccc;
            width: 150px;
            background-color: azure;
        }

        .product-card {
            border: 1px solid #ccc;
            margin-top: 10px;
            padding: 10px;
            width: 300px;
        }

        #totalInfo {
            border: 1px solid #ccc;
            margin-top: 10px;
            padding: 10px;
            width: 300px;
        }
    </style>
    <title>Dynamic Search</title>
</head>
<body>
    <div>
        <input type="text" id="search" oninput="showSuggestions(this.value)" onblur="hideSuggestions()" class="input">
        <div id="suggestions"></div>
    </div>

    <div id="totalInfo">
        <h2>Загальна інформація</h2>
        <div>Вага страви, г: <span id="totalQuantity">0</span> г</div>
        <div>Всього ккал, г: <span id="totalCalories">0</span></div>
        <div>Всього білків, г: <span id="totalProteins">0</span> г</div>
        <div>Всього жирів, г: <span id="totalFats">0</span> г</div>
        <div>Всього вуглеводів, г: <span id="totalCarbs">0</span> г</div>
        <br>
        <div>КБЖВ на 100г продукту:</div>
        <div> Калорії: <span id="avgСalories">0</span> г</div>
        <div>Білки: <span id="avgProteins">0</span> г</div>
        <div>Жири: <span id="avgFats">0</span> г</div>
        <div>Вуглеводи: <span id="avgCarbs">0</span> г</div>
    </div>

    <div id="userProducts"></div>

    <script>
        var products = [
            { category: 'Фрукти', name: 'Яблуко', quantity: 100, proteins: 0.5, fats: 0.2, carbs: 14, calories: 52 },
            { category: 'Мясо', name: 'Курятина', quantity: 100,proteins: 25, fats: 3.6, carbs: 0, calories: 135 },
            { category: 'Злаки', name: 'Гречка', quantity: 100,proteins: 12.6, fats: 2.3, carbs: 62, calories: 335 }
            // Додайте інші продукти за необхідністю
        ];

        var userProducts = [];

        function showSuggestions(query) {
            var suggestionsDiv = document.getElementById('suggestions');
            suggestionsDiv.innerHTML = '';

            if (query.trim() === '') {
                suggestionsDiv.style.display = 'none';
                return;
            }

            var matches = products.filter(function(product) {
                return product.name.toLowerCase().includes(query.toLowerCase());
            });

            if (matches.length > 0) {
                suggestionsDiv.style.display = 'block';
                matches.forEach(function(match) {
                    var suggestion = document.createElement('div');
                    suggestion.textContent = match.name;
                    suggestion.onclick = function() {
                        addProductToUser(match);
                        suggestionsDiv.style.display = 'none';
                    };
                    suggestionsDiv.appendChild(suggestion);
                });
            } else {
                suggestionsDiv.style.display = 'none';
            }
        }

        function hideSuggestions() {
            setTimeout(function() {
                document.getElementById('suggestions').style.display = 'none';
            }, 200);
        }

        function addProductToUser(product) {
            var quantity = prompt('Введіть кількість продукту (г):', '100');
            if (!quantity) return;

            quantity = parseFloat(quantity);

            if (isNaN(quantity) || quantity <= 0) {
                alert('Будь ласка, введіть правильну кількість.');
                return;
            }

            var userProduct = {
                name: product.name,
                quantity: quantity,
                proteins: (product.proteins / 100) * quantity,
                fats: (product.fats / 100) * quantity,
                carbs: (product.carbs / 100) * quantity,
                calories: (product.calories / 100) * quantity
            };

            userProducts.push(userProduct);

            updatePage();
        }

        function updatePage() {
            var userProductsDiv = document.getElementById('userProducts');
            userProductsDiv.innerHTML = '';

            var totalQuantity = 0;
            var totalCalories = 0;
            var totalProteins = 0;
            var totalFats = 0;
            var totalCarbs = 0;

            userProducts.forEach(function(product) {
                var card = document.createElement('div');
                card.classList.add('product-card');
                card.innerHTML = `
                    <div><strong>${product.name}</strong></div>
                    <div>Кількість: <input type="number" value="${product.quantity}" onchange="updateQuantity(this, ${userProducts.indexOf(product)})"> г</div>
                    <div>Ккал: ${product.calories.toFixed(2)}</div>
                    <div>Білки: ${product.proteins.toFixed(2)} г</div>
                    <div>Жири: ${product.fats.toFixed(2)} г</div>
                    <div>Вуглеводи: ${product.carbs.toFixed(2)} г</div>
                `;
                userProductsDiv.appendChild(card);

                totalQuantity += product.quantity;
                totalCalories += product.calories;
                totalProteins += product.proteins;
                totalFats += product.fats;
                totalCarbs += product.carbs;
            });

            document.getElementById('totalQuantity').textContent = totalQuantity.toFixed(2);
            document.getElementById('totalCalories').textContent = totalCalories.toFixed(2);
            document.getElementById('totalProteins').textContent = totalProteins.toFixed(2);
            document.getElementById('totalFats').textContent = totalFats.toFixed(2);
            document.getElementById('totalCarbs').textContent = totalCarbs.toFixed(2);

            var avgСalories = ((totalCalories / totalQuantity) * 100).toFixed(2);
            var avgProteins = ((totalProteins / totalQuantity) * 100).toFixed(2);
            var avgFats = ((totalFats / totalQuantity) * 100).toFixed(2);
            var avgCarbs = ((totalCarbs / totalQuantity) * 100).toFixed(2);

            document.getElementById('avgСalories').textContent = avgСalories;
            document.getElementById('avgProteins').textContent = avgProteins;
            document.getElementById('avgFats').textContent = avgFats;
            document.getElementById('avgCarbs').textContent = avgCarbs;

            document.getElementById('search').value = '';
        }

        function updateQuantity(input, index) {
            var newQuantity = parseFloat(input.value);

            if (isNaN(newQuantity) || newQuantity <= 0) {
                alert('Будь ласка, введіть правильну кількість.');
                input.value = userProducts[index].quantity;
                return;
            }

            userProducts[index].quantity = newQuantity;
            userProducts[index].proteins = (products[index].proteins / 100) * newQuantity;
            userProducts[index].fats = (products[index].fats / 100) * newQuantity;
            userProducts[index].carbs = (products[index].carbs / 100) * newQuantity;
            userProducts[index].calories = (products[index].calories / 100) * newQuantity;

            updatePage();
        }
    </script>
</body>
</html>
